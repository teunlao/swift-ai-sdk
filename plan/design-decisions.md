# Design Decisions Log

- **HTTPClient на базе URLSession.** Позволяет работать на macOS/iOS без сторонних зависимостей, поддерживает SSE и адаптируется через протоколы.
- **Telemetry через opentelemetry-swift.** Сохраняем совместимость с `@opentelemetry/api`, предоставляем no-op реализацию для окружений без OTel.
- **Namespace AISDK + alias ai.** Глобальные функции доступны через `AISDK.generateText`, алиас `ai` для короткой записи.
- **Сохранение LanguageModelV2.** Для паритета с TypeScript адаптер V2→V3 реализуется полностью.
- **Собственная семвер-линия.** Версии пакета — `0.x.y`, в changelog фиксируем upstream commit.
- 2025-10-12T14:32:04Z [executor][gpt-5] Schema & validation: реализуем собственный слой `Schema`/`FlexibleSchema` с ленивым JSON Schema resolver и native validator closures; стандартные схемы `arktype`/`effect`/`valibot` поддерживаем через generic интерфейс, для `vendor == "zod"` выбрасываем зеркальную `UnsupportedStandardSchemaVendorError`, чтобы явно сигналить отсутствие zod в Swift; паритет достигается тем, что `parseJSON`/`validateTypes` повторяют логику TypeScript, а тесты покрывают те же сценарии, используя Swift-билдеры вместо JS библиотек.
- 2025-10-12T15:19:11Z [executor][gpt-5] Ограничения схем: до появления Swift-адаптеров приём стандартных вендоров (`arktype`, `effect`, `valibot`) работает только через переданный `jsonSchema`/`validate` closure; автогенерация JSON Schema не поддерживается. Документируем требование использовать `Schema.codable` или кастомные валидаторы и оставляем TODO на будущий Swift DSL.
- 2025-10-12T17:46:00Z [executor][claude-code] **HTTP Response Status Text**: Swift's `HTTPURLResponse` не предоставляет HTTP reason phrase из ответа сервера (в отличие от `response.statusText` в Fetch API). **Адаптация**: `ProviderHTTPResponse` принимает опциональный параметр `statusText` для явного указания; если не предоставлен, используется fallback через `HTTPURLResponse.localizedString(forStatusCode:)` (локализованная строка). **Влияние**: минимальное — большинство провайдеров используют стандартные HTTP коды; кастомные сообщения об ошибках находятся в теле ответа, а не в status line. **Trade-off**: локализованный текст более дружелюбен для пользователя, чем server-provided reason phrase, который может отсутствовать.
